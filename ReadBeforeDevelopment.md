# 設計
## はじめに
* SelfPortalはアジャイル開発スタイルを取り入れていますが、それは設計フェーズが存在しないという意味ではありません
    * アジャイル開発は、一連のフェーズを小さく繰り返すというだけで、ウォーターフォールと同様に設計フェーズは存在します
* 同様に設計ドキュメントが必要ないということにもなりません(必ず必要というわけでもありません)
    * **必要に応じて**設計ドキュメントを適宜作成します
        * 開発者以外に仕様を伝えるため
        * 将来の保守のために、その意図や仕組みを開発者に伝えるため
        * 開発者によるコード理解の手助けとするため
        * etc.
* 設計をするための知識が足りていない場合や調査が必要な場合に、はじめに手を動かす(スパイクやプロトタイピング)ということはアリですが、その場合でもある段階(必要な知識が揃った段階)で必ず設計フェーズが訪れるはずです
    * **試行錯誤していた過程のコードや仕様がいつの間にか正式なものになっていた**、ということにならないように

## 設計フェーズ
便宜上、ここでは設計フェーズを「外部設計」「内部設計」の2つに分けて説明します。
それぞれの設計を以下のように定義します。

* 外部設計
    * アプリケーションの外部仕様を決めるフェーズ
    * ここでの外部仕様とは「アプリケーションを操作する人やその他のアプリケーション(APIクライアントなど)へアプリケーションが提供するインターフェースのフォーマットおよび制約」とします
* 内部設計
    * アプリケーションの内部仕様を決めるフェーズ
    * ここでの内部仕様とは「アプリケーション内部のコードおよびデータのフォーマットや構造」とします

### 注意点
* 必ずしもすべての設計をFixしてから実装へ進まなければならないという訳ではありません
* 一度決めた設計を後から変えてはならないという訳ではありません
    * これは設計者と実装者が異なる場合も同様です。ただしその場合は両者で議論した上で設計を変更すべきです
* 必ずしもこの2つのフェーズに分けて設計を行わなければならないという訳ではありません
    * ただし設計フェーズにおいてはこれらの異なる2つの観点での設計が必ず必要となります
* 必ずしも外部設計→内部設計の順に行わなければならないという訳でもありません
    * ですが、ほとんどの部分においては外部設計が決まらなければ内部設計ができないと思います
* ある観点の設計が外部設計なのか内部設計なのか、という議論はここでは重要ではありません。決めるべきことを漏れなく決めることが重要なのです

## 外部設計
具体的には以下のようなことを決めます

* 方式設計
    * アーキテクチャ(他のサービスと連携するか、各所で発生するデータをどこに格納するか、etc.)
    * サーバサイドで処理するか、クライアントサイドで処理するか
    * 誰と誰が通信するか、各所においてどのような情報をやりとりするか
    * 使用する技術要素、プロトコル
* 機能設計
    * ユーザは何ができるか
    * ユーザは何ができないか
    * どの権限で操作ができるか
    * どの権限で操作ができないか
    * 一般アカウントで何ができるか、何ができないか
    * 管理者アカウントで何ができるか、何ができないか

* 画面設計
    * 画面遷移
    * 文言
    * レイアウト
    * メッセージ

### 注意点
* 外部設計は、必ずサービス仕様や新機能に求められる機能要件をインプットとして行います

## 内部設計
具体的には以下のようなことを決めます

* URL(パスおよびHTTPメソッド、対応するアクション名)
* 使用するGemおよびそのバージョン
* メソッドのスコープ
* メソッドの引数と戻り値の型(RubyにおいてはClass)
* データをキャッシュするかどうか、どこにキャッシュするか
* モジュール化するかどうか、その継承構造

### Model
* アソシエーション
* バリデーション
* 属性名
* Model名、属性名の訳語
* 属性にEnumerizeを使用するかどうか

### View
* Viewファイル名(通常は対応するアクションと同名)
* パーシャルに分割するかどうか
* Helperにメソッド

### Controller
* Strong Parametersで許可する属性
* レスポンスのステータスコードおよびBodyの内容

### データベース
* カラム名
* データ型およびデータ長
* 制約
* インデックス
